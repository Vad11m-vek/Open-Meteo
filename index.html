<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Windy Weather Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            padding: 20px;
            color: #fff;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .header {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 30px;
            border-radius: 20px;
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .api-form {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr;
            gap: 15px;
            margin-top: 20px;
        }
        
        .api-form input, .api-form button {
            padding: 15px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
        }
        
        .api-form input {
            background: rgba(255, 255, 255, 0.9);
        }
        
        .api-form button {
            background: #27ae60;
            color: white;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        .api-form button:hover {
            background: #229954;
            transform: translateY(-2px);
        }
        
        .loading {
            text-align: center;
            padding: 50px;
            font-size: 1.5em;
        }
        
        .weather-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .weather-card {
            background: rgba(30, 60, 114, 0.8);
            backdrop-filter: blur(10px);
            padding: 25px;
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .weather-card .icon {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .weather-card .title {
            font-size: 0.9em;
            opacity: 0.8;
            margin-bottom: 5px;
        }
        
        .weather-card .value {
            font-size: 1.8em;
            font-weight: bold;
        }
        
        .weather-card .subtitle {
            font-size: 0.85em;
            opacity: 0.7;
            margin-top: 5px;
        }
        
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .tab {
            background: rgba(255, 255, 255, 0.1);
            padding: 12px 24px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }
        
        .tab:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .tab.active {
            background: rgba(39, 174, 96, 0.3);
            border-color: #27ae60;
        }
        
        .table-container {
            background: rgba(30, 60, 114, 0.8);
            backdrop-filter: blur(10px);
            padding: 25px;
            border-radius: 15px;
            overflow-x: auto;
            margin-bottom: 30px;
        }
        
        .table-container h2 {
            margin-bottom: 20px;
            font-size: 1.5em;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 800px;
        }
        
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        th {
            background: rgba(39, 174, 96, 0.3);
            font-weight: bold;
            position: sticky;
            top: 0;
        }
        
        tr:hover {
            background: rgba(255, 255, 255, 0.05);
        }
        
        .arrow {
            display: inline-block;
            transition: transform 0.3s;
        }
        
        .warning {
            background: rgba(230, 126, 34, 0.3);
            padding: 3px 8px;
            border-radius: 5px;
            font-size: 0.9em;
        }
        
        .good {
            background: rgba(39, 174, 96, 0.3);
            padding: 3px 8px;
            border-radius: 5px;
            font-size: 0.9em;
        }
        
        .bad {
            background: rgba(231, 76, 60, 0.3);
            padding: 3px 8px;
            border-radius: 5px;
            font-size: 0.9em;
        }
        
        .error {
            background: rgba(231, 76, 60, 0.8);
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            text-align: center;
        }
        
        .day-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            overflow-x: auto;
            padding-bottom: 10px;
        }
        
        .day-tab {
            background: rgba(255, 255, 255, 0.1);
            padding: 10px 20px;
            border-radius: 10px;
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.3s;
            min-width: 120px;
            text-align: center;
        }
        
        .day-tab:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .day-tab.active {
            background: rgba(39, 174, 96, 0.3);
            border: 2px solid #27ae60;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üå§Ô∏è Windy Weather Dashboard</h1>
            <div class="api-form">
                <input type="text" id="apiKey" placeholder="API –ö–ª—é—á Windy">
                <input type="number" id="lat" value="50.45" step="0.01" placeholder="–®–∏—Ä–æ—Ç–∞">
                <input type="number" id="lon" value="30.52" step="0.01" placeholder="–î–æ–≤–≥–æ—Ç–∞">
                <button onclick="fetchWeather()">–û—Ç—Ä–∏–º–∞—Ç–∏ –ø—Ä–æ–≥–Ω–æ–∑</button>
            </div>
        </div>
        
        <div id="loading" class="loading" style="display: none;">
            ‚è≥ –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö...
        </div>
        
        <div id="error" class="error" style="display: none;"></div>
        
        <div id="weatherContent" style="display: none;">
            <!-- –ö–∞—Ä—Ç–æ—á–∫–∏ –ø–æ–≥–æ–¥–∏ -->
            <div class="weather-cards" id="weatherCards"></div>
            
            <!-- –í–∫–ª–∞–¥–∫–∏ -->
            <div class="tabs">
                <div class="tab active" onclick="showTab('hourly')">üìä –ü–æ–≥–æ–¥–∏–Ω–Ω–∏–π –ø—Ä–æ–≥–Ω–æ–∑</div>
                <div class="tab" onclick="showTab('profile')">üìè –ü—Ä–æ—Ñ—ñ–ª—å –≤—ñ—Ç—Ä—É</div>
            </div>
            
            <!-- –ü–æ–≥–æ–¥–∏–Ω–Ω–∏–π –ø—Ä–æ–≥–Ω–æ–∑ -->
            <div id="hourlyTab" class="table-container">
                <h2>‚è∞ –ü–æ–≥–æ–¥–∏–Ω–Ω–∏–π –ø—Ä–æ–≥–Ω–æ–∑</h2>
                <div class="day-tabs" id="hourlyDayTabs"></div>
                <div style="overflow-x: auto;">
                    <table id="hourlyTable">
                        <thead>
                            <tr>
                                <th>‚è∞ –ß–∞—Å</th>
                                <th>üí® –í—ñ—Ç–µ—Ä (–º/—Å)</th>
                                <th>üå™Ô∏è –ü–æ—Ä–∏–≤–∏ (–º/—Å)</th>
                                <th>‚û§ –ù–∞–ø—Ä—è–º–æ–∫</th>
                                <th>üå°Ô∏è –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ (¬∞C)</th>
                                <th>üíß –í–æ–ª–æ–≥—ñ—Å—Ç—å</th>
                                <th>üåßÔ∏è –û–ø–∞–¥–∏ (–º–º)</th>
                                <th>‚òÅÔ∏è –•–º–∞—Ä–Ω—ñ—Å—Ç—å</th>
                                <th>üå°Ô∏è –¢–æ—á–∫–∞ —Ä–æ—Å–∏ (¬∞C)</th>
                                <th>üìä –¢–∏—Å–∫ (–≥–ü–∞)</th>
                            </tr>
                        </thead>
                        <tbody id="hourlyBody"></tbody>
                    </table>
                </div>
            </div>
            
            <!-- –ü—Ä–æ—Ñ—ñ–ª—å –≤—ñ—Ç—Ä—É -->
            <div id="profileTab" class="table-container" style="display: none;">
                <h2>üìè –ü—Ä–æ—Ñ—ñ–ª—å –≤—ñ—Ç—Ä—É (–ø–æ –≤–∏—Å–æ—Ç–∞—Ö)</h2>
                <div class="day-tabs" id="profileDayTabs"></div>
                <div style="overflow-x: auto;">
                    <table id="profileTable">
                        <thead>
                            <tr>
                                <th>‚¨ÜÔ∏è –í–∏—Å–æ—Ç–∞</th>
                                <th>üí® –®–≤–∏–¥–∫—ñ—Å—Ç—å –≤—ñ—Ç—Ä—É</th>
                                <th>üå™Ô∏è –®–≤–∏–¥–∫—ñ—Å—Ç—å –ø–æ—Ä–∏–≤</th>
                                <th>‚û§ –ù–∞–ø—Ä—è–º–æ–∫</th>
                                <th>üå°Ô∏è –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞</th>
                            </tr>
                        </thead>
                        <tbody id="profileBody"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        let weatherData = null;
        let currentHourlyDay = 0;
        let currentProfileDay = 0;
        let currentProfileHour = 0;

        const levelHeights = {
            'surface': 10,
            '1000h': 100,
            '950h': 500,
            '925h': 750,
            '900h': 1000,
            '850h': 1500,
            '800h': 2000,
            '700h': 3000,
            '600h': 4200,
            '500h': 5500,
            '400h': 7200,
            '300h': 9200,
            '200h': 11800,
            '150h': 13600
        };

        function showTab(tab) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            
            if (tab === 'hourly') {
                document.getElementById('hourlyTab').style.display = 'block';
                document.getElementById('profileTab').style.display = 'none';
            } else {
                document.getElementById('hourlyTab').style.display = 'none';
                document.getElementById('profileTab').style.display = 'block';
            }
        }

        function calculateWindSpeed(u, v) {
            return Math.sqrt(u * u + v * v);
        }

        function calculateWindDirection(u, v) {
            let angle = (Math.atan2(u, v) * 180 / Math.PI + 180) % 360;
            return Math.round(angle);
        }

        function getWindDirectionText(degrees) {
            const directions = ['–ü–Ω', '–ü–Ω–°—Ö', '–°—Ö', '–ü–¥–°—Ö', '–ü–¥', '–ü–¥–ó—Ö', '–ó—Ö', '–ü–Ω–ó—Ö'];
            const index = Math.round(degrees / 45) % 8;
            return directions[index];
        }

        function getWindArrow(degrees) {
            return `<span class="arrow" style="transform: rotate(${degrees}deg)">‚û§</span>`;
        }

        function kelvinToCelsius(k) {
            return (k - 273.15).toFixed(1);
        }

        function formatDate(timestamp) {
            const date = new Date(timestamp);
            return date.toLocaleDateString('uk-UA', { day: '2-digit', month: '2-digit' });
        }

        function formatTime(timestamp) {
            const date = new Date(timestamp);
            return date.toLocaleTimeString('uk-UA', { hour: '2-digit', minute: '2-digit' });
        }

        function getCloudCoverage(low, mid, high) {
            const total = Math.max(low || 0, mid || 0, high || 0);
            return Math.round(total * 100);
        }

        async function fetchWeather() {
            const apiKey = document.getElementById('apiKey').value;
            const lat = parseFloat(document.getElementById('lat').value);
            const lon = parseFloat(document.getElementById('lon').value);

            if (!apiKey) {
                showError('‚ùå –ë—É–¥—å –ª–∞—Å–∫–∞, –≤–≤–µ–¥—ñ—Ç—å API –∫–ª—é—á!');
                return;
            }

            document.getElementById('loading').style.display = 'block';
            document.getElementById('error').style.display = 'none';
            document.getElementById('weatherContent').style.display = 'none';

            try {
                const response = await fetch('https://api.windy.com/api/point-forecast/v2', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        lat: lat,
                        lon: lon,
                        model: 'gfs',
                        parameters: ['temp', 'wind', 'precip', 'pressure', 'windGust', 'dewpoint', 'rh', 'lclouds', 'mclouds', 'hclouds'],
                        levels: ['surface', '1000h', '950h', '925h', '900h', '850h', '800h', '700h', '600h', '500h', '400h', '300h', '200h', '150h'],
                        key: apiKey
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }

                weatherData = await response.json();
                displayWeather();
                
                document.getElementById('loading').style.display = 'none';
                document.getElementById('weatherContent').style.display = 'block';

            } catch (error) {
                showError(`‚ùå –ü–æ–º–∏–ª–∫–∞: ${error.message}`);
                document.getElementById('loading').style.display = 'none';
            }
        }

        function showError(message) {
            document.getElementById('error').textContent = message;
            document.getElementById('error').style.display = 'block';
        }

        function displayWeather() {
            displayWeatherCards();
            displayHourlyForecast();
            displayWindProfile();
        }

        function displayWeatherCards() {
            const current = 0; // –ü–µ—Ä—à–∏–π –µ–ª–µ–º–µ–Ω—Ç –º–∞—Å–∏–≤—É
            const u = weatherData['wind_u-surface'][current];
            const v = weatherData['wind_v-surface'][current];
            const windSpeed = calculateWindSpeed(u, v);
            const windDir = calculateWindDirection(u, v);
            const temp = kelvinToCelsius(weatherData['temp-surface'][current]);
            const dewpoint = kelvinToCelsius(weatherData['dewpoint-surface'][current]);
            const rh = Math.round((weatherData['rh-surface'][current] || 0) * 100);
            const gust = weatherData['gust-surface'][current].toFixed(1);
            const pressure = (weatherData['pressure-surface'][current] / 100).toFixed(0);
            const precip = ((weatherData['past3hprecip-surface'][current] || 0) * 1000).toFixed(1);
            const clouds = getCloudCoverage(
                weatherData['lclouds-surface']?.[current],
                weatherData['mclouds-surface']?.[current],
                weatherData['hclouds-surface']?.[current]
            );

            const cards = `
                <div class="weather-card">
                    <div class="icon">üå°Ô∏è</div>
                    <div class="title">–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞</div>
                    <div class="value">${temp}¬∞C</div>
                    <div class="subtitle">–¢–æ—á–∫–∞ —Ä–æ—Å–∏: ${dewpoint}¬∞C<br>–í–æ–ª–æ–≥—ñ—Å—Ç—å: ${rh}%</div>
                </div>
                <div class="weather-card">
                    <div class="icon">üí®</div>
                    <div class="title">–í—ñ—Ç–µ—Ä</div>
                    <div class="value">${windSpeed.toFixed(1)} –º/—Å</div>
                    <div class="subtitle">${getWindArrow(windDir)} ${windDir}¬∞ ${getWindDirectionText(windDir)}</div>
                </div>
                <div class="weather-card">
                    <div class="icon">üå™Ô∏è</div>
                    <div class="title">–ü–æ—Ä–∏–≤–∏</div>
                    <div class="value">${gust} –º/—Å</div>
                </div>
                <div class="weather-card">
                    <div class="icon">üåßÔ∏è</div>
                    <div class="title">–û–ø–∞–¥–∏</div>
                    <div class="value">${precip} –º–º</div>
                    <div class="subtitle">–ó–∞ –æ—Å—Ç–∞–Ω–Ω—ñ 3 –≥–æ–¥</div>
                </div>
                <div class="weather-card">
                    <div class="icon">‚òÅÔ∏è</div>
                    <div class="title">–•–º–∞—Ä–Ω—ñ—Å—Ç—å</div>
                    <div class="value">${clouds}%</div>
                </div>
                <div class="weather-card">
                    <div class="icon">üìä</div>
                    <div class="title">–¢–∏—Å–∫</div>
                    <div class="value">${pressure} –≥–ü–∞</div>
                </div>
            `;

            document.getElementById('weatherCards').innerHTML = cards;
        }

        function displayHourlyForecast() {
            // –ì—Ä—É–ø—É—î–º–æ –¥–∞–Ω—ñ –ø–æ –¥–Ω—è—Ö
            const days = {};
            weatherData.ts.forEach((timestamp, i) => {
                const date = formatDate(timestamp);
                if (!days[date]) days[date] = [];
                days[date].push(i);
            });

            const dayKeys = Object.keys(days);
            
            // –°—Ç–≤–æ—Ä—é—î–º–æ –≤–∫–ª–∞–¥–∫–∏ –¥–Ω—ñ–≤
            const dayTabsHtml = dayKeys.map((day, idx) => 
                `<div class="day-tab ${idx === currentHourlyDay ? 'active' : ''}" onclick="selectHourlyDay(${idx})">${day}</div>`
            ).join('');
            document.getElementById('hourlyDayTabs').innerHTML = dayTabsHtml;

            // –í—ñ–¥–æ–±—Ä–∞–∂–∞—î–º–æ –¥–∞–Ω—ñ –¥–ª—è –ø–æ—Ç–æ—á–Ω–æ–≥–æ –¥–Ω—è
            const currentDayIndices = days[dayKeys[currentHourlyDay]];
            let rows = '';

            currentDayIndices.forEach(i => {
                const u = weatherData['wind_u-surface'][i];
                const v = weatherData['wind_v-surface'][i];
                const windSpeed = calculateWindSpeed(u, v);
                const windDir = calculateWindDirection(u, v);
                const temp = kelvinToCelsius(weatherData['temp-surface'][i]);
                const dewpoint = kelvinToCelsius(weatherData['dewpoint-surface'][i]);
                const rh = Math.round((weatherData['rh-surface'][i] || 0) * 100);
                const gust = weatherData['gust-surface'][i].toFixed(1);
                const pressure = (weatherData['pressure-surface'][i] / 100).toFixed(0);
                const precip = ((weatherData['past3hprecip-surface'][i] || 0) * 1000).toFixed(1);
                const clouds = getCloudCoverage(
                    weatherData['lclouds-surface']?.[i],
                    weatherData['mclouds-surface']?.[i],
                    weatherData['hclouds-surface']?.[i]
                );

                rows += `
                    <tr>
                        <td>${formatTime(weatherData.ts[i])}</td>
                        <td>${windSpeed.toFixed(1)}</td>
                        <td>${gust}</td>
                        <td>${getWindArrow(windDir)} ${windDir}¬∞ ${getWindDirectionText(windDir)}</td>
                        <td>${temp}</td>
                        <td>${rh}%</td>
                        <td>${precip}</td>
                        <td>${clouds}%</td>
                        <td>${dewpoint}</td>
                        <td>${pressure}</td>
                    </tr>
                `;
            });

            document.getElementById('hourlyBody').innerHTML = rows;
        }

        function selectHourlyDay(dayIndex) {
            currentHourlyDay = dayIndex;
            displayHourlyForecast();
        }

        function displayWindProfile() {
            // –ì—Ä—É–ø—É—î–º–æ –¥–∞–Ω—ñ –ø–æ –¥–Ω—è—Ö
            const days = {};
            weatherData.ts.forEach((timestamp, i) => {
                const date = formatDate(timestamp);
                if (!days[date]) days[date] = [];
                days[date].push(i);
            });

            const dayKeys = Object.keys(days);
            
            // –°—Ç–≤–æ—Ä—é—î–º–æ –≤–∫–ª–∞–¥–∫–∏ –¥–Ω—ñ–≤
            const dayTabsHtml = dayKeys.map((day, idx) => 
                `<div class="day-tab ${idx === currentProfileDay ? 'active' : ''}" onclick="selectProfileDay(${idx})">${day} ${formatTime(weatherData.ts[days[day][0]])}</div>`
            ).join('');
            document.getElementById('profileDayTabs').innerHTML = dayTabsHtml;

            // –í—ñ–¥–æ–±—Ä–∞–∂–∞—î–º–æ –ø—Ä–æ—Ñ—ñ–ª—å –¥–ª—è –ø–µ—Ä—à–æ—ó –≥–æ–¥–∏–Ω–∏ –≤–∏–±—Ä–∞–Ω–æ–≥–æ –¥–Ω—è
            const currentDayIndices = days[dayKeys[currentProfileDay]];
            const hourIndex = currentDayIndices[0]; // –ü–µ—Ä—à–∞ –≥–æ–¥–∏–Ω–∞ –¥–Ω—è

            const levels = Object.keys(levelHeights).reverse();
            let rows = '';

            levels.forEach(level => {
                const uKey = `wind_u-${level}`;
                const vKey = `wind_v-${level}`;
                const tempKey = `temp-${level}`;
                const gustKey = `gust-${level}`;

                if (weatherData[uKey] && weatherData[vKey]) {
                    const u = weatherData[uKey][hourIndex];
                    const v = weatherData[vKey][hourIndex];
                    const windSpeed = calculateWindSpeed(u, v);
                    const windDir = calculateWindDirection(u, v);
                    const temp = kelvinToCelsius(weatherData[tempKey][hourIndex]);
                    const gust = weatherData[gustKey] ? weatherData[gustKey][hourIndex].toFixed(1) : '-';
                    const height = levelHeights[level];

                    rows += `
                        <tr>
                            <td><strong>${height}–º</strong></td>
                            <td>${getWindArrow(windDir)} ${windSpeed.toFixed(1)} –º/—Å / ${(windSpeed * 3.6).toFixed(0)} –∫–º/–≥</td>
                            <td>${gust !== '-' ? `${getWindArrow(windDir)} ${gust} –º/—Å / ${(parseFloat(gust) * 3.6).toFixed(0)} –∫–º/–≥` : '-'}</td>
                            <td>${windDir}¬∞ ${getWindDirectionText(windDir)}</td>
                            <td>${temp}¬∞C</td>
                        </tr>
                    `;
                }
            });

            document.getElementById('profileBody').innerHTML = rows;
        }

        function selectProfileDay(dayIndex) {
            currentProfileDay = dayIndex;
            displayWindProfile();
        }
    </script>
</body>
</html>
