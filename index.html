<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#2c5f2d">
    <title>UAV Forecast Pro</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(180deg, #1a3a1c 0%, #2c5f2d 100%);
            color: #fff;
            min-height: 100vh;
        }

        .header {
            background: rgba(0,0,0,0.3);
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .location-selector {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
        }

        .location-name {
            font-size: 1.1rem;
            font-weight: 600;
        }

        .header-buttons {
            display: flex;
            gap: 10px;
        }

        .icon-btn {
            background: rgba(255,255,255,0.1);
            border: none;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.2rem;
            transition: all 0.2s;
        }

        .icon-btn:hover {
            background: rgba(255,255,255,0.2);
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }

        /* –ü–ª–∏—Ç–∫–∏ */
        .tiles-section {
            margin-bottom: 20px;
        }

        .section-header {
            font-size: 0.9rem;
            opacity: 0.8;
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .tiles-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-bottom: 20px;
        }

        .tile {
            background: rgba(0,0,0,0.3);
            border-radius: 12px;
            padding: 16px;
            border: 1px solid rgba(255,255,255,0.1);
            transition: all 0.2s;
        }

        .tile:hover {
            background: rgba(0,0,0,0.4);
            transform: translateY(-2px);
        }

        .tile-header {
            font-size: 0.75rem;
            opacity: 0.7;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .tile-icon {
            font-size: 1.5rem;
            margin-bottom: 8px;
        }

        .tile-value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .tile-sub {
            font-size: 0.85rem;
            opacity: 0.7;
        }

        /* Timeline */
        .timeline-section {
            background: rgba(0,0,0,0.3);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .timeline-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .timeline-title {
            font-size: 1.1rem;
            font-weight: 600;
        }

        .timeline-controls {
            display: flex;
            gap: 8px;
        }

        .timeline-btn {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1rem;
        }

        .timeline-scroll {
            display: flex;
            gap: 10px;
            overflow-x: auto;
            padding: 10px 0;
            scrollbar-width: thin;
            scrollbar-color: rgba(255,255,255,0.3) transparent;
        }

        .timeline-scroll::-webkit-scrollbar {
            height: 6px;
        }

        .timeline-scroll::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.1);
            border-radius: 3px;
        }

        .timeline-scroll::-webkit-scrollbar-thumb {
            background: rgba(255,255,255,0.3);
            border-radius: 3px;
        }

        .timeline-item {
            min-width: 80px;
            text-align: center;
            padding: 12px;
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            border: 2px solid transparent;
        }

        .timeline-item:hover {
            background: rgba(255,255,255,0.1);
        }

        .timeline-item.active {
            background: rgba(76, 175, 80, 0.3);
            border-color: #4CAF50;
        }

        .timeline-time {
            font-size: 0.95rem;
            font-weight: 600;
            margin-bottom: 6px;
        }

        .timeline-icon {
            font-size: 1.2rem;
            margin: 6px 0;
        }

        .timeline-wind {
            font-size: 0.85rem;
            opacity: 0.9;
            margin-bottom: 4px;
        }

        .timeline-temp {
            font-size: 0.8rem;
            opacity: 0.7;
        }

        /* –î–µ—Ç–∞–ª—å–Ω–∞ —Ç–∞–±–ª–∏—Ü—è */
        .detail-section {
            background: rgba(0,0,0,0.3);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .detail-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 15px;
        }

        .detail-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
        }

        .detail-table th {
            background: rgba(255,255,255,0.1);
            padding: 12px 10px;
            text-align: left;
            font-weight: 600;
            border-bottom: 2px solid rgba(255,255,255,0.2);
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .detail-table td {
            padding: 12px 10px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .detail-table tr:hover {
            background: rgba(255,255,255,0.05);
        }

        .detail-table .hour-col {
            font-weight: 600;
        }

        /* –ü—Ä–æ—Ñ—ñ–ª—å –≤—ñ—Ç—Ä—É */
        .profile-section {
            background: rgba(0,0,0,0.3);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .profile-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
        }

        .profile-table th {
            background: rgba(255,255,255,0.1);
            padding: 12px;
            text-align: left;
            font-weight: 600;
            border-bottom: 2px solid rgba(255,255,255,0.2);
        }

        .profile-table td {
            padding: 12px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .profile-table tr:hover {
            background: rgba(255,255,255,0.05);
        }

        .height-label {
            font-weight: 700;
            font-size: 1rem;
        }

        .source-tag {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.7rem;
            font-weight: 600;
            margin-left: 6px;
        }

        .source-openmeteo {
            background: rgba(76, 175, 80, 0.3);
            color: #a5d6a7;
        }

        .source-windy {
            background: rgba(33, 150, 243, 0.3);
            color: #90caf9;
        }

        /* Loading */
        .loading {
            text-align: center;
            padding: 40px;
            font-size: 1.1rem;
        }

        .spinner {
            border: 3px solid rgba(255,255,255,0.1);
            border-top: 3px solid white;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Modal –¥–ª—è –≤–∏–±–æ—Ä—É –ª–æ–∫–∞—Ü—ñ—ó */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: #2c5f2d;
            border-radius: 12px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 20px;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .input-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid rgba(255,255,255,0.2);
            border-radius: 8px;
            background: rgba(0,0,0,0.3);
            color: white;
            font-size: 1rem;
        }

        .preset-locations {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 20px;
        }

        .preset-btn {
            padding: 12px;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 8px;
            color: white;
            cursor: pointer;
            transition: all 0.2s;
        }

        .preset-btn:hover {
            background: rgba(255,255,255,0.2);
        }

        .modal-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .btn-primary {
            flex: 1;
            padding: 12px;
            background: #4CAF50;
            border: none;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            cursor: pointer;
        }

        .btn-secondary {
            flex: 1;
            padding: 12px;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 8px;
            color: white;
            font-weight: 600;
            cursor: pointer;
        }

        @media (max-width: 768px) {
            .tiles-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .tile-value {
                font-size: 1.6rem;
            }

            .detail-table {
                font-size: 0.8rem;
            }

            .detail-table th,
            .detail-table td {
                padding: 8px 6px;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <div class="location-selector" onclick="showLocationModal()">
            <span>üìç</span>
            <span class="location-name" id="location-name">–ö–∏—ó–≤, –£–∫—Ä–∞—ó–Ω–∞</span>
        </div>
        <div class="header-buttons">
            <button class="icon-btn" onclick="refreshData()" title="–û–Ω–æ–≤–∏—Ç–∏">üîÑ</button>
        </div>
    </div>

    <div class="container">
        <!-- Loading -->
        <div id="loading" class="loading" style="display: none;">
            <div class="spinner"></div>
            <p>–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö...</p>
        </div>

        <!-- –û—Å–Ω–æ–≤–Ω—ñ –ø–ª–∏—Ç–∫–∏ -->
        <div class="tiles-section" id="tiles-section" style="display: none;">
            <div class="section-header">–ú–æ–∂–Ω–∞ –ª—ñ—Ç–∞—Ç–∏</div>
            <div class="tiles-grid" id="main-tiles">
                <!-- –ì–µ–Ω–µ—Ä—É—é—Ç—å—Å—è JS -->
            </div>
        </div>

        <!-- Timeline -->
        <div class="timeline-section" id="timeline-section" style="display: none;">
            <div class="timeline-header">
                <div class="timeline-title">–ü—Ä–æ–≥–Ω–æ–∑</div>
                <div class="timeline-controls">
                    <button class="timeline-btn" onclick="scrollTimeline(-1)">‚óÄ</button>
                    <button class="timeline-btn" onclick="scrollTimeline(1)">‚ñ∂</button>
                </div>
            </div>
            <div class="timeline-scroll" id="timeline-scroll">
                <!-- –ì–µ–Ω–µ—Ä—É—î—Ç—å—Å—è JS -->
            </div>
        </div>

        <!-- –î–µ—Ç–∞–ª—å–Ω–∞ —Ç–∞–±–ª–∏—Ü—è -->
        <div class="detail-section" id="detail-section" style="display: none;">
            <div class="detail-title">–î–µ—Ç–∞–ª—å–Ω–∏–π –ø—Ä–æ–≥–Ω–æ–∑</div>
            <div style="overflow-x: auto;">
                <table class="detail-table" id="detail-table">
                    <!-- –ì–µ–Ω–µ—Ä—É—î—Ç—å—Å—è JS -->
                </table>
            </div>
        </div>

        <!-- –ü—Ä–æ—Ñ—ñ–ª—å –≤—ñ—Ç—Ä—É -->
        <div class="profile-section" id="profile-section" style="display: none;">
            <div class="detail-title">–ü—Ä–æ—Ñ—ñ–ª—å –≤—ñ—Ç—Ä—É –Ω–∞ –≤–∏—Å–æ—Ç–∞—Ö</div>
            <table class="profile-table" id="profile-table">
                <!-- –ì–µ–Ω–µ—Ä—É—î—Ç—å—Å—è JS -->
            </table>
        </div>
    </div>

    <!-- Modal –≤–∏–±–æ—Ä—É –ª–æ–∫–∞—Ü—ñ—ó -->
    <div class="modal" id="location-modal">
        <div class="modal-content">
            <div class="modal-title">–í–∏–±—ñ—Ä –ª–æ–∫–∞—Ü—ñ—ó</div>
            <div class="input-group">
                <label>–®–∏—Ä–æ—Ç–∞ (¬∞N):</label>
                <input type="number" id="modal-lat" step="0.01" value="50.45">
            </div>
            <div class="input-group">
                <label>–î–æ–≤–≥–æ—Ç–∞ (¬∞E):</label>
                <input type="number" id="modal-lon" step="0.01" value="30.52">
            </div>
            <div class="input-group">
                <label>–ù–∞–∑–≤–∞:</label>
                <input type="text" id="modal-name" value="–ö–∏—ó–≤, –£–∫—Ä–∞—ó–Ω–∞">
            </div>
            <div class="preset-locations">
                <button class="preset-btn" onclick="setPreset(50.45, 30.52, '–ö–∏—ó–≤')">üá∫üá¶ –ö–∏—ó–≤</button>
                <button class="preset-btn" onclick="setPreset(46.48, 30.73, '–û–¥–µ—Å–∞')">üá∫üá¶ –û–¥–µ—Å–∞</button>
                <button class="preset-btn" onclick="setPreset(49.99, 36.23, '–•–∞—Ä–∫—ñ–≤')">üá∫üá¶ –•–∞—Ä–∫—ñ–≤</button>
                <button class="preset-btn" onclick="setPreset(48.46, 35.05, '–î–Ω—ñ–ø—Ä–æ')">üá∫üá¶ –î–Ω—ñ–ø—Ä–æ</button>
            </div>
            <div class="modal-buttons">
                <button class="btn-primary" onclick="applyLocation()">–ó–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏</button>
                <button class="btn-secondary" onclick="closeLocationModal()">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
            </div>
        </div>
    </div>

    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ñ –∑–º—ñ–Ω–Ω—ñ
        let location = {
            lat: 50.45,
            lon: 30.52,
            name: '–ö–∏—ó–≤, –£–∫—Ä–∞—ó–Ω–∞'
        };

        let weatherData = {
            openmeteo: null,
            windy: null
        };

        let currentTimeIndex = 0;

        // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è
        document.addEventListener('DOMContentLoaded', () => {
            loadData();
        });

        // –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö
        async function loadData() {
            document.getElementById('loading').style.display = 'block';
            hideAllSections();

            try {
                const [openmeteo, windy] = await Promise.all([
                    fetchOpenMeteo(),
                    fetchWindy()
                ]);

                weatherData.openmeteo = openmeteo;
                weatherData.windy = windy;

                console.log('Weather Data:', weatherData);

                renderUI();
                showAllSections();
            } catch (error) {
                console.error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è:', error);
                alert('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö: ' + error.message);
            } finally {
                document.getElementById('loading').style.display = 'none';
            }
        }

        // Open-Meteo API
        async function fetchOpenMeteo() {
            const url = `https://api.open-meteo.com/v1/forecast?` +
                `latitude=${location.lat}&longitude=${location.lon}` +
                `&hourly=windspeed_10m,windspeed_80m,windspeed_120m,windspeed_180m` +
                `,winddirection_10m,winddirection_80m,winddirection_120m,winddirection_180m` +
                `,windgusts_10m` +
                `,temperature_2m,temperature_80m,temperature_120m,temperature_180m` +
                `,relativehumidity_2m,dewpoint_2m` +
                `,cloudcover,cloudcover_low,cloudcover_mid,cloudcover_high` +
                `,visibility,precipitation,weathercode` +
                `&timezone=auto&forecast_days=2`;

            const response = await fetch(url);
            if (!response.ok) throw new Error('Open-Meteo API error');
            return await response.json();
        }

        // Windy API
        async function fetchWindy() {
            const url = 'https://api.windy.com/api/point-forecast/v2';
            const body = {
                lat: location.lat,
                lon: location.lon,
                model: "gfs",
                parameters: ["wind", "temp", "dewpoint", "rh", "pressure"],
                levels: ["surface", "950h", "900h", "850h", "800h", "700h", "600h", "500h"],
                key: "8LSlMIu1xWAVn4ePmrgxIMyzvg9VBC6G"
            };

            const response = await fetch(url, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(body)
            });

            if (!response.ok) throw new Error('Windy API error');
            return await response.json();
        }

        // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ UI
        function renderUI() {
            renderTiles();
            renderTimeline();
            renderDetailTable();
            renderWindProfile();
        }

        // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –ø–ª–∏—Ç–æ–∫
        function renderTiles() {
            const data = weatherData.openmeteo.hourly;
            const now = findCurrentHourIndex(weatherData.openmeteo);

            const tiles = [
                {
                    icon: 'üí®',
                    label: '–í—ñ—Ç–µ—Ä',
                    value: `${Math.round(data.windspeed_10m[now])} –∫–º/–≥–æ–¥`,
                    sub: `–º–∞–∫—Å 1 500+ –º`
                },
                {
                    icon: 'üå™Ô∏è',
                    label: '–ü–æ—Ä–∏–≤–∏',
                    value: `${Math.round(data.windgusts_10m[now])} –∫–º/–≥–æ–¥`,
                    sub: `–º–∞–∫—Å 1 500+ –º`
                },
                {
                    icon: 'üå°Ô∏è',
                    label: '–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞',
                    value: `${Math.round(data.temperature_2m[now])}¬∞C`,
                    sub: `–í—ñ–¥—á. –≤–æ–ª–æ–≥—ñ—Å—Ç—å: ${data.relativehumidity_2m[now]}%`
                },
                {
                    icon: 'üíß',
                    label: '–í–æ–ª–æ–≥—ñ—Å—Ç—å',
                    value: `${data.relativehumidity_2m[now]}%`,
                    sub: ''
                },
                {
                    icon: '‚òÅÔ∏è',
                    label: '–•–º–∞—Ä–Ω—ñ—Å—Ç—å',
                    value: `${data.cloudcover[now]}%`,
                    sub: `–ë–∞–∑–∞ —Ö–º–∞—Ä ${data.cloudcover_low[now]}%`
                },
                {
                    icon: 'üëÅÔ∏è',
                    label: '–í–∏–¥–∏–º—ñ—Å—Ç—å',
                    value: `${Math.round(data.visibility[now] / 1000)} –∫–º`,
                    sub: ''
                }
            ];

            const html = tiles.map(tile => `
                <div class="tile">
                    <div class="tile-icon">${tile.icon}</div>
                    <div class="tile-header">${tile.label}</div>
                    <div class="tile-value">${tile.value}</div>
                    ${tile.sub ? `<div class="tile-sub">${tile.sub}</div>` : ''}
                </div>
            `).join('');

            document.getElementById('main-tiles').innerHTML = html;
        }

        // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ timeline
        function renderTimeline() {
            const data = weatherData.openmeteo.hourly;
            const hours = data.time.slice(0, 24);

            const html = hours.map((time, index) => {
                const date = new Date(time);
                const hour = date.getHours().toString().padStart(2, '0');
                const wind = Math.round(data.windspeed_10m[index]);
                const temp = Math.round(data.temperature_2m[index]);
                const icon = getWeatherIcon(data.weathercode[index]);

                return `
                    <div class="timeline-item ${index === currentTimeIndex ? 'active' : ''}" onclick="selectTime(${index})">
                        <div class="timeline-time">${hour}:00</div>
                        <div class="timeline-icon">${icon}</div>
                        <div class="timeline-wind">${wind} –∫–º/–≥–æ–¥</div>
                        <div class="timeline-temp">${temp}¬∞C</div>
                    </div>
                `;
            }).join('');

            document.getElementById('timeline-scroll').innerHTML = html;
        }

        // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –¥–µ—Ç–∞–ª—å–Ω–æ—ó —Ç–∞–±–ª–∏—Ü—ñ
        function renderDetailTable() {
            const data = weatherData.openmeteo.hourly;
            const hours = data.time.slice(0, 24);

            let html = `
                <thead>
                    <tr>
                        <th>–ß–∞—Å</th>
                        <th>–í—ñ—Ç–µ—Ä</th>
                        <th>–ü–æ—Ä–∏–≤–∏</th>
                        <th>–í–∏—Å–æ—Ç–∞ –º–∞–∫—Å.</th>
                        <th>–¢–µ–º–ø.</th>
                        <th>–í–æ–ª–æ–≥—ñ—Å—Ç—å</th>
                        <th>–•–º–∞—Ä–∏</th>
                        <th>–í–∏–¥–∏–º—ñ—Å—Ç—å</th>
                    </tr>
                </thead>
                <tbody>
            `;

            hours.forEach((time, index) => {
                const date = new Date(time);
                const hour = date.getHours().toString().padStart(2, '0');

                html += `
                    <tr>
                        <td class="hour-col">${hour}:00</td>
                        <td>${Math.round(data.windspeed_10m[index])} –∫–º/–≥–æ–¥</td>
                        <td>${Math.round(data.windgusts_10m[index])} –∫–º/–≥–æ–¥</td>
                        <td>1 500+ –º</td>
                        <td>${Math.round(data.temperature_2m[index])}¬∞C</td>
                        <td>${data.relativehumidity_2m[index]}%</td>
                        <td>${data.cloudcover[index]}%</td>
                        <td>${Math.round(data.visibility[index] / 1000)} –∫–º</td>
                    </tr>
                `;
            });

            html += '</tbody>';
            document.getElementById('detail-table').innerHTML = html;
        }

        // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –ø—Ä–æ—Ñ—ñ–ª—é –≤—ñ—Ç—Ä—É
        function renderWindProfile() {
            const om = weatherData.openmeteo.hourly;
            const wd = weatherData.windy;
            const now = findCurrentHourIndex(weatherData.openmeteo);

            let html = `
                <thead>
                    <tr>
                        <th>–í–∏—Å–æ—Ç–∞</th>
                        <th>–®–≤–∏–¥–∫—ñ—Å—Ç—å –≤—ñ—Ç—Ä—É</th>
                        <th>–ü–æ—Ä–∏–≤–∏</th>
                        <th>–ù–∞–ø—Ä—è–º–æ–∫</th>
                        <th>–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞</th>
                    </tr>
                </thead>
                <tbody>
            `;

            // Open-Meteo —Ä—ñ–≤–Ω—ñ
            const omLevels = [
                { height: '10–º', speed: om.windspeed_10m[now], gusts: om.windgusts_10m[now], dir: om.winddirection_10m[now], temp: om.temperature_2m[now] },
                { height: '80–º', speed: om.windspeed_80m[now], gusts: '-', dir: om.winddirection_80m[now], temp: om.temperature_80m[now] },
                { height: '120–º', speed: om.windspeed_120m[now], gusts: '-', dir: om.winddirection_120m[now], temp: om.temperature_120m[now] },
                { height: '180–º', speed: om.windspeed_180m[now], gusts: '-', dir: om.winddirection_180m[now], temp: om.temperature_180m[now] }
            ];

            omLevels.forEach(level => {
                html += `
                    <tr>
                        <td><span class="height-label">${level.height}</span> <span class="source-tag source-openmeteo">Open-Meteo</span></td>
                        <td>${Math.round(level.speed)} –∫–º/–≥–æ–¥</td>
                        <td>${typeof level.gusts === 'number' ? Math.round(level.gusts) + ' –∫–º/–≥–æ–¥' : level.gusts}</td>
                        <td>${Math.round(level.dir)}¬∞ (${getDirectionName(level.dir)})</td>
                        <td>${Math.round(level.temp)}¬∞C</td>
                    </tr>
                `;
            });

            // Windy —Ä—ñ–≤–Ω—ñ
            const windyLevels = {
                '950h': '500–º',
                '900h': '1000–º',
                '850h': '1500–º',
                '800h': '2000–º',
                '700h': '3000–º',
                '600h': '4200–º',
                '500h': '5500–º'
            };

            const windyIndex = 0; // –ü–µ—Ä—à–∞ —Ç–æ—á–∫–∞ –≤ —á–∞—Å—ñ

            Object.entries(windyLevels).forEach(([level, height]) => {
                const wind = calculateWind(
                    wd[`wind_u-${level}`][windyIndex],
                    wd[`wind_v-${level}`][windyIndex]
                );
                const temp = kelvinToCelsius(wd[`temp-${level}`][windyIndex]);

                html += `
                    <tr>
                        <td><span class="height-label">${height}</span> <span class="source-tag source-windy">Windy</span></td>
                        <td>${Math.round(wind.speed)} –∫–º/–≥–æ–¥</td>
                        <td>-</td>
                        <td>${Math.round(wind.direction)}¬∞ (${getDirectionName(wind.direction)})</td>
                        <td>${Math.round(temp)}¬∞C</td>
                    </tr>
                `;
            });

            html += '</tbody>';
            document.getElementById('profile-table').innerHTML = html;
        }

        // –î–æ–ø–æ–º—ñ–∂–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó
        function calculateWind(u, v) {
            const speed = Math.sqrt(u * u + v * v) * 3.6;
            const direction = (Math.atan2(-u, -v) * 180 / Math.PI + 360) % 360;
            return { speed, direction };
        }

        function kelvinToCelsius(kelvin) {
            return kelvin - 273.15;
        }

        function getDirectionName(deg) {
            const directions = ['–ü–Ω', '–ü–Ω–°—Ö', '–°—Ö', '–ü–¥–°—Ö', '–ü–¥', '–ü–¥–ó—Ö', '–ó—Ö', '–ü–Ω–ó—Ö'];
            return directions[Math.round(deg / 45) % 8];
        }

        function getWeatherIcon(code) {
            const icons = {
                0: '‚òÄÔ∏è', 1: 'üå§Ô∏è', 2: '‚õÖ', 3: '‚òÅÔ∏è',
                45: 'üå´Ô∏è', 48: 'üå´Ô∏è',
                51: 'üå¶Ô∏è', 53: 'üå¶Ô∏è', 55: 'üåßÔ∏è',
                61: 'üåßÔ∏è', 63: 'üåßÔ∏è', 65: 'üåßÔ∏è',
                71: 'üå®Ô∏è', 73: 'üå®Ô∏è', 75: 'üå®Ô∏è',
                95: '‚õàÔ∏è', 96: '‚õàÔ∏è', 99: '‚õàÔ∏è'
            };
            return icons[code] || 'üå§Ô∏è';
        }

        function findCurrentHourIndex(data) {
            const now = new Date();
            const currentHour = now.getHours();
            return data.hourly.time.findIndex(time => {
                return new Date(time).getHours() === currentHour;
            }) || 0;
        }

        function selectTime(index) {
            currentTimeIndex = index;
            renderTimeline();
        }

        function scrollTimeline(direction) {
            const scroll = document.getElementById('timeline-scroll');
            scroll.scrollBy({ left: direction * 200, behavior: 'smooth' });
        }

        function refreshData() {
            loadData();
        }

        // –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ
        function showLocationModal() {
            document.getElementById('location-modal').classList.add('active');
            document.getElementById('modal-lat').value = location.lat;
            document.getElementById('modal-lon').value = location.lon;
            document.getElementById('modal-name').value = location.name;
        }

        function closeLocationModal() {
            document.getElementById('location-modal').classList.remove('active');
        }

        function setPreset(lat, lon, name) {
            document.getElementById('modal-lat').value = lat;
            document.getElementById('modal-lon').value = lon;
            document.getElementById('modal-name').value = name + ', –£–∫—Ä–∞—ó–Ω–∞';
        }

        function applyLocation() {
            location.lat = parseFloat(document.getElementById('modal-lat').value);
            location.lon = parseFloat(document.getElementById('modal-lon').value);
            location.name = document.getElementById('modal-name').value;

            document.getElementById('location-name').textContent = location.name;
            closeLocationModal();
            loadData();
        }

        function hideAllSections() {
            document.getElementById('tiles-section').style.display = 'none';
            document.getElementById('timeline-section').style.display = 'none';
            document.getElementById('detail-section').style.display = 'none';
            document.getElementById('profile-section').style.display = 'none';
        }

        function showAllSections() {
            document.getElementById('tiles-section').style.display = 'block';
            document.getElementById('timeline-section').style.display = 'block';
            document.getElementById('detail-section').style.display = 'block';
            document.getElementById('profile-section').style.display = 'block';
        }
    </script>
</body>
</html>
