<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UAV Forecast Pro - 4 Models</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(180deg, #1a3a1c 0%, #2c5f2d 100%);
            color: #fff;
            min-height: 100vh;
        }

        .header {
            background: rgba(0,0,0,0.3);
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .location-selector {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            padding: 8px 12px;
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            transition: all 0.2s;
        }

        .location-selector:hover {
            background: rgba(255,255,255,0.15);
        }

        .location-name {
            font-size: 1.1rem;
            font-weight: 600;
        }

        .icon-btn {
            background: rgba(255,255,255,0.1);
            border: none;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.2rem;
            transition: all 0.2s;
        }

        .icon-btn:hover {
            background: rgba(255,255,255,0.2);
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }

        .model-selector {
            background: rgba(0,0,0,0.3);
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .model-selector-title {
            font-size: 0.9rem;
            opacity: 0.8;
            margin-bottom: 10px;
        }

        .model-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
        }

        .model-btn {
            padding: 12px;
            background: rgba(255,255,255,0.1);
            border: 2px solid rgba(255,255,255,0.2);
            color: white;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
            text-align: center;
        }

        .model-btn:hover {
            background: rgba(255,255,255,0.15);
        }

        .model-btn.active {
            background: rgba(76, 175, 80, 0.4);
            border-color: #4CAF50;
        }

        .model-tag {
            display: block;
            font-size: 0.7rem;
            opacity: 0.7;
            margin-top: 4px;
        }

        .tiles-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-bottom: 20px;
        }

        .tile {
            background: rgba(0,0,0,0.3);
            border-radius: 12px;
            padding: 16px;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .tile-icon {
            font-size: 1.5rem;
            margin-bottom: 8px;
        }

        .tile-header {
            font-size: 0.75rem;
            opacity: 0.7;
            margin-bottom: 8px;
            text-transform: uppercase;
        }

        .tile-value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .tile-sub {
            font-size: 0.85rem;
            opacity: 0.7;
        }

        .timeline-section {
            background: rgba(0,0,0,0.3);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .timeline-scroll {
            display: flex;
            gap: 10px;
            overflow-x: auto;
            padding: 10px 0;
        }

        .timeline-item {
            min-width: 80px;
            text-align: center;
            padding: 12px;
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
            cursor: pointer;
            border: 2px solid transparent;
        }

        .timeline-item.active {
            background: rgba(76, 175, 80, 0.3);
            border-color: #4CAF50;
        }

        .timeline-time {
            font-size: 0.95rem;
            font-weight: 600;
            margin-bottom: 6px;
        }

        .timeline-icon {
            font-size: 1.2rem;
            margin: 6px 0;
        }

        .timeline-wind {
            font-size: 0.85rem;
        }

        .profile-section {
            background: rgba(0,0,0,0.3);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .section-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 15px;
        }

        .profile-table {
            width: 100%;
            border-collapse: collapse;
        }

        .profile-table th {
            background: rgba(255,255,255,0.1);
            padding: 12px;
            text-align: left;
            font-weight: 600;
            border-bottom: 2px solid rgba(255,255,255,0.2);
        }

        .profile-table td {
            padding: 12px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .profile-table tr:hover {
            background: rgba(255,255,255,0.05);
        }

        .height-label {
            font-weight: 700;
            font-size: 1rem;
        }

        .source-label {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.7rem;
            font-weight: 600;
            margin-left: 6px;
        }

        .source-gfs { background: rgba(76, 175, 80, 0.3); }
        .source-icon { background: rgba(33, 150, 243, 0.3); }
        .source-ecmwf { background: rgba(156, 39, 176, 0.3); }
        .source-windy { background: rgba(255, 152, 0, 0.3); }

        .loading {
            text-align: center;
            padding: 40px;
        }

        .spinner {
            border: 3px solid rgba(255,255,255,0.1);
            border-top: 3px solid white;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: #2c5f2d;
            border-radius: 12px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 20px;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .input-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid rgba(255,255,255,0.2);
            border-radius: 8px;
            background: rgba(0,0,0,0.3);
            color: white;
            font-size: 1rem;
        }

        .preset-locations {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin: 20px 0;
        }

        .preset-btn {
            padding: 12px;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 8px;
            color: white;
            cursor: pointer;
        }

        .modal-buttons {
            display: flex;
            gap: 10px;
        }

        .btn-primary {
            flex: 1;
            padding: 12px;
            background: #4CAF50;
            border: none;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            cursor: pointer;
        }

        .btn-secondary {
            flex: 1;
            padding: 12px;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 8px;
            color: white;
            font-weight: 600;
            cursor: pointer;
        }

        .comparison-section {
            background: rgba(0,0,0,0.3);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .comparison-table {
            width: 100%;
            border-collapse: collapse;
        }

        .comparison-table th {
            background: rgba(255,255,255,0.1);
            padding: 10px;
            text-align: center;
            font-weight: 600;
            border-bottom: 2px solid rgba(255,255,255,0.2);
        }

        .comparison-table td {
            padding: 10px;
            text-align: center;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        @media (max-width: 768px) {
            .tiles-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            .tile-value {
                font-size: 1.6rem;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="location-selector" onclick="openLocationModal()">
            <span>üìç</span>
            <span class="location-name" id="locationName">–ö–∏—ó–≤, –£–∫—Ä–∞—ó–Ω–∞</span>
        </div>
        <button class="icon-btn" onclick="reloadData()" title="–û–Ω–æ–≤–∏—Ç–∏">üîÑ</button>
    </div>

    <div class="container">
        <div id="loading" class="loading">
            <div class="spinner"></div>
            <p>–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö...</p>
        </div>

        <!-- –í–∏–±—ñ—Ä –º–æ–¥–µ–ª—ñ -->
        <div class="model-selector" id="modelSelector" style="display: none;">
            <div class="model-selector-title">–û–±–µ—Ä—ñ—Ç—å –º–æ–¥–µ–ª—å –ø—Ä–æ–≥–Ω–æ–∑—É:</div>
            <div class="model-buttons">
                <button class="model-btn active" data-model="gfs" onclick="selectModel('gfs')">
                    GFS
                    <span class="model-tag">NOAA</span>
                </button>
                <button class="model-btn" data-model="icon" onclick="selectModel('icon')">
                    ICON
                    <span class="model-tag">DWD</span>
                </button>
                <button class="model-btn" data-model="ecmwf" onclick="selectModel('ecmwf')">
                    ECMWF
                    <span class="model-tag">–ù–∞–π—Ç–æ—á–Ω—ñ—à–∏–π</span>
                </button>
                <button class="model-btn" data-model="windy" onclick="selectModel('windy')">
                    Windy
                    <span class="model-tag">8 –≤–∏—Å–æ—Ç</span>
                </button>
            </div>
        </div>

        <!-- –ü–ª–∏—Ç–∫–∏ -->
        <div class="tiles-grid" id="tilesGrid" style="display: none;"></div>

        <!-- Timeline -->
        <div class="timeline-section" id="timelineSection" style="display: none;">
            <div class="section-title">–ü—Ä–æ–≥–Ω–æ–∑ –ø–æ –≥–æ–¥–∏–Ω–∞—Ö</div>
            <div class="timeline-scroll" id="timelineScroll"></div>
        </div>

        <!-- –ü—Ä–æ—Ñ—ñ–ª—å –≤—ñ—Ç—Ä—É -->
        <div class="profile-section" id="profileSection" style="display: none;">
            <div class="section-title">–ü—Ä–æ—Ñ—ñ–ª—å –≤—ñ—Ç—Ä—É –Ω–∞ –≤–∏—Å–æ—Ç–∞—Ö</div>
            <table class="profile-table" id="profileTable"></table>
        </div>

        <!-- –ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –º–æ–¥–µ–ª–µ–π -->
        <div class="comparison-section" id="comparisonSection" style="display: none;">
            <div class="section-title">–ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –º–æ–¥–µ–ª–µ–π (–ø–æ—Ç–æ—á–Ω–∏–π —á–∞—Å)</div>
            <table class="comparison-table" id="comparisonTable"></table>
        </div>
    </div>

    <!-- Modal -->
    <div class="modal" id="locationModal">
        <div class="modal-content">
            <div class="modal-title">–í–∏–±—ñ—Ä –ª–æ–∫–∞—Ü—ñ—ó</div>
            <div class="input-group">
                <label>–®–∏—Ä–æ—Ç–∞:</label>
                <input type="number" id="inputLat" step="0.01" value="50.45">
            </div>
            <div class="input-group">
                <label>–î–æ–≤–≥–æ—Ç–∞:</label>
                <input type="number" id="inputLon" step="0.01" value="30.52">
            </div>
            <div class="input-group">
                <label>–ù–∞–∑–≤–∞:</label>
                <input type="text" id="inputName" value="–ö–∏—ó–≤, –£–∫—Ä–∞—ó–Ω–∞">
            </div>
            <div class="preset-locations">
                <button class="preset-btn" onclick="setPreset(50.45, 30.52, '–ö–∏—ó–≤')">üá∫üá¶ –ö–∏—ó–≤</button>
                <button class="preset-btn" onclick="setPreset(46.48, 30.73, '–û–¥–µ—Å–∞')">üá∫üá¶ –û–¥–µ—Å–∞</button>
                <button class="preset-btn" onclick="setPreset(49.99, 36.23, '–•–∞—Ä–∫—ñ–≤')">üá∫üá¶ –•–∞—Ä–∫—ñ–≤</button>
                <button class="preset-btn" onclick="setPreset(48.46, 35.05, '–î–Ω—ñ–ø—Ä–æ')">üá∫üá¶ –î–Ω—ñ–ø—Ä–æ</button>
            </div>
            <div class="modal-buttons">
                <button class="btn-primary" onclick="applyLocation()">–ó–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏</button>
                <button class="btn-secondary" onclick="closeLocationModal()">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
            </div>
        </div>
    </div>

    <script>
        // –°—Ç–∞–Ω –¥–æ–¥–∞—Ç–∫—É
        const appState = {
            currentLocation: { lat: 50.45, lon: 30.52, name: '–ö–∏—ó–≤, –£–∫—Ä–∞—ó–Ω–∞' },
            currentModel: 'gfs',
            weatherData: {}
        };

        // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è
        document.addEventListener('DOMContentLoaded', () => {
            loadAllData();
        });

        // –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –≤—Å—ñ—Ö –¥–∞–Ω–∏—Ö
        async function loadAllData() {
            showLoading(true);
            
            try {
                const [gfs, icon, ecmwf, windy] = await Promise.all([
                    fetchOpenMeteo('best_match'),
                    fetchOpenMeteo('icon_global'),
                    fetchOpenMeteo('ecmwf_ifs025'),
                    fetchWindy()
                ]);

                appState.weatherData = { gfs, icon, ecmwf, windy };
                console.log('–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω—ñ –¥–∞–Ω—ñ:', appState.weatherData);

                renderUI();
                showAllSections();
            } catch (error) {
                console.error('–ü–æ–º–∏–ª–∫–∞:', error);
                alert('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è: ' + error.message);
            } finally {
                showLoading(false);
            }
        }

        // Open-Meteo API
        async function fetchOpenMeteo(model) {
            const { lat, lon } = appState.currentLocation;
            const url = `https://api.open-meteo.com/v1/forecast?` +
                `latitude=${lat}&longitude=${lon}` +
                `&models=${model}` +
                `&hourly=windspeed_10m,windspeed_80m,windspeed_120m,windspeed_180m` +
                `,winddirection_10m,winddirection_80m,winddirection_120m,winddirection_180m` +
                `,windgusts_10m,temperature_2m,temperature_80m,temperature_120m,temperature_180m` +
                `,relativehumidity_2m,cloudcover,visibility,precipitation,weathercode` +
                `&timezone=auto&forecast_days=2`;

            const response = await fetch(url);
            if (!response.ok) throw new Error(`Open-Meteo ${model} error`);
            return await response.json();
        }

        // Windy API
        async function fetchWindy() {
            const { lat, lon } = appState.currentLocation;
            const response = await fetch('https://api.windy.com/api/point-forecast/v2', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    lat, lon,
                    model: "gfs",
                    parameters: ["wind", "temp"],
                    levels: ["surface", "950h", "900h", "850h", "800h", "700h", "600h", "500h"],
                    key: "8LSlMIu1xWAVn4ePmrgxIMyzvg9VBC6G"
                })
            });
            if (!response.ok) throw new Error('Windy API error');
            return await response.json();
        }

        // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ UI
        function renderUI() {
            const model = appState.currentModel;
            const data = appState.weatherData[model];
            
            if (!data) return;

            if (model === 'windy') {
                renderWindyUI(data);
            } else {
                renderOpenMeteoUI(data);
            }

            renderComparison();
        }

        // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ Open-Meteo
        function renderOpenMeteoUI(data) {
            const now = findCurrentHourIndex(data);
            
            // –ü–ª–∏—Ç–∫–∏
            const tiles = [
                { icon: 'üí®', label: '–í—ñ—Ç–µ—Ä', value: `${Math.round(data.hourly.windspeed_10m[now])} –∫–º/–≥–æ–¥` },
                { icon: 'üå™Ô∏è', label: '–ü–æ—Ä–∏–≤–∏', value: `${Math.round(data.hourly.windgusts_10m[now])} –∫–º/–≥–æ–¥` },
                { icon: 'üå°Ô∏è', label: '–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞', value: `${Math.round(data.hourly.temperature_2m[now])}¬∞C` },
                { icon: 'üíß', label: '–í–æ–ª–æ–≥—ñ—Å—Ç—å', value: `${data.hourly.relativehumidity_2m[now]}%` },
                { icon: '‚òÅÔ∏è', label: '–•–º–∞—Ä–Ω—ñ—Å—Ç—å', value: `${data.hourly.cloudcover[now]}%` },
                { icon: 'üëÅÔ∏è', label: '–í–∏–¥–∏–º—ñ—Å—Ç—å', value: `${Math.round(data.hourly.visibility[now]/1000)} –∫–º` }
            ];

            document.getElementById('tilesGrid').innerHTML = tiles.map(t => `
                <div class="tile">
                    <div class="tile-icon">${t.icon}</div>
                    <div class="tile-header">${t.label}</div>
                    <div class="tile-value">${t.value}</div>
                </div>
            `).join('');

            // Timeline
            const timeline = data.hourly.time.slice(0, 24).map((time, i) => {
                const hour = new Date(time).getHours().toString().padStart(2, '0');
                const wind = Math.round(data.hourly.windspeed_10m[i]);
                const icon = getWeatherIcon(data.hourly.weathercode[i]);
                return `
                    <div class="timeline-item ${i === 0 ? 'active' : ''}">
                        <div class="timeline-time">${hour}:00</div>
                        <div class="timeline-icon">${icon}</div>
                        <div class="timeline-wind">${wind} –∫–º/–≥–æ–¥</div>
                    </div>
                `;
            }).join('');

            document.getElementById('timelineScroll').innerHTML = timeline;

            // –ü—Ä–æ—Ñ—ñ–ª—å –≤—ñ—Ç—Ä—É
            renderWindProfile();
        }

        // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ Windy
        function renderWindyUI(data) {
            const wind = calculateWind(data['wind_u-surface'][0], data['wind_v-surface'][0]);
            const temp = kelvinToCelsius(data['temp-surface'][0]);

            const tiles = [
                { icon: 'üí®', label: '–í—ñ—Ç–µ—Ä', value: `${Math.round(wind.speed)} –∫–º/–≥–æ–¥` },
                { icon: 'üå°Ô∏è', label: '–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞', value: `${Math.round(temp)}¬∞C` }
            ];

            document.getElementById('tilesGrid').innerHTML = tiles.map(t => `
                <div class="tile">
                    <div class="tile-icon">${t.icon}</div>
                    <div class="tile-header">${t.label}</div>
                    <div class="tile-value">${t.value}</div>
                </div>
            `).join('');

            renderWindProfile();
        }

        // –ü—Ä–æ—Ñ—ñ–ª—å –≤—ñ—Ç—Ä—É
        function renderWindProfile() {
            const model = appState.currentModel;
            let html = '<thead><tr><th>–í–∏—Å–æ—Ç–∞</th><th>–®–≤–∏–¥–∫—ñ—Å—Ç—å</th><th>–ü–æ—Ä–∏–≤–∏</th><th>–ù–∞–ø—Ä—è–º–æ–∫</th><th>–¢–µ–º–ø.</th></tr></thead><tbody>';

            if (model === 'windy') {
                const wd = appState.weatherData.windy;
                const levels = {
                    'surface': '10–º', '950h': '500–º', '900h': '1000–º', '850h': '1500–º',
                    '800h': '2000–º', '700h': '3000–º', '600h': '4200–º', '500h': '5500–º'
                };

                Object.entries(levels).forEach(([level, height]) => {
                    const wind = calculateWind(wd[`wind_u-${level}`][0], wd[`wind_v-${level}`][0]);
                    const temp = kelvinToCelsius(wd[`temp-${level}`][0]);
                    html += `
                        <tr>
                            <td><span class="height-label">${height}</span> <span class="source-label source-windy">Windy</span></td>
                            <td>${Math.round(wind.speed)} –∫–º/–≥–æ–¥</td>
                            <td>-</td>
                            <td>${Math.round(wind.direction)}¬∞ (${getDirectionName(wind.direction)})</td>
                            <td>${Math.round(temp)}¬∞C</td>
                        </tr>
                    `;
                });
            } else {
                const data = appState.weatherData[model].hourly;
                const now = findCurrentHourIndex(appState.weatherData[model]);
                const sourceClass = model === 'gfs' ? 'source-gfs' : model === 'icon' ? 'source-icon' : 'source-ecmwf';
                const sourceName = model.toUpperCase();

                const levels = [
                    { h: '10–º', s: data.windspeed_10m[now], g: data.windgusts_10m[now], d: data.winddirection_10m[now], t: data.temperature_2m[now] },
                    { h: '80–º', s: data.windspeed_80m[now], g: '-', d: data.winddirection_80m[now], t: data.temperature_80m[now] },
                    { h: '120–º', s: data.windspeed_120m[now], g: '-', d: data.winddirection_120m[now], t: data.temperature_120m[now] },
                    { h: '180–º', s: data.windspeed_180m[now], g: '-', d: data.winddirection_180m[now], t: data.temperature_180m[now] }
                ];

                levels.forEach(l => {
                    html += `
                        <tr>
                            <td><span class="height-label">${l.h}</span> <span class="source-label ${sourceClass}">${sourceName}</span></td>
                            <td>${Math.round(l.s)} –∫–º/–≥–æ–¥</td>
                            <td>${typeof l.g === 'number' ? Math.round(l.g) + ' –∫–º/–≥–æ–¥' : l.g}</td>
                            <td>${Math.round(l.d)}¬∞ (${getDirectionName(l.d)})</td>
                            <td>${Math.round(l.t)}¬∞C</td>
                        </tr>
                    `;
                });
            }

            html += '</tbody>';
            document.getElementById('profileTable').innerHTML = html;
        }

        // –ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –º–æ–¥–µ–ª–µ–π
        function renderComparison() {
            let html = '<thead><tr><th>–ü–∞—Ä–∞–º–µ—Ç—Ä</th><th>GFS</th><th>ICON</th><th>ECMWF</th><th>Windy</th></tr></thead><tbody>';

            const params = ['–í—ñ—Ç–µ—Ä 10–º', '–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞', '–í–æ–ª–æ–≥—ñ—Å—Ç—å'];
            
            params.forEach(param => {
                html += `<tr><td><strong>${param}</strong></td>`;
                
                ['gfs', 'icon', 'ecmwf'].forEach(model => {
                    const data = appState.weatherData[model];
                    if (data) {
                        const now = findCurrentHourIndex(data);
                        let value = '-';
                        if (param === '–í—ñ—Ç–µ—Ä 10–º') value = `${Math.round(data.hourly.windspeed_10m[now])} –∫–º/–≥–æ–¥`;
                        else if (param === '–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞') value = `${Math.round(data.hourly.temperature_2m[now])}¬∞C`;
                        else if (param === '–í–æ–ª–æ–≥—ñ—Å—Ç—å') value = `${data.hourly.relativehumidity_2m[now]}%`;
                        html += `<td>${value}</td>`;
                    } else {
                        html += '<td>-</td>';
                    }
                });

                const wd = appState.weatherData.windy;
                if (wd) {
                    let value = '-';
                    if (param === '–í—ñ—Ç–µ—Ä 10–º') {
                        const wind = calculateWind(wd['wind_u-surface'][0], wd['wind_v-surface'][0]);
                        value = `${Math.round(wind.speed)} –∫–º/–≥–æ–¥`;
                    } else if (param === '–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞') {
                        value = `${Math.round(kelvinToCelsius(wd['temp-surface'][0]))}¬∞C`;
                    }
                    html += `<td>${value}</td>`;
                } else {
                    html += '<td>-</td>';
                }

                html += '</tr>';
            });

            html += '</tbody>';
            document.getElementById('comparisonTable').innerHTML = html;
        }

        // –î–æ–ø–æ–º—ñ–∂–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó
        function calculateWind(u, v) {
            const speed = Math.sqrt(u * u + v * v) * 3.6;
            const direction = (Math.atan2(-u, -v) * 180 / Math.PI + 360) % 360;
            return { speed, direction };
        }

        function kelvinToCelsius(k) {
            return k - 273.15;
        }

        function getDirectionName(deg) {
            const dirs = ['–ü–Ω', '–ü–Ω–°—Ö', '–°—Ö', '–ü–¥–°—Ö', '–ü–¥', '–ü–¥–ó—Ö', '–ó—Ö', '–ü–Ω–ó—Ö'];
            return dirs[Math.round(deg / 45) % 8];
        }

        function getWeatherIcon(code) {
            const icons = { 0: '‚òÄÔ∏è', 1: 'üå§Ô∏è', 2: '‚õÖ', 3: '‚òÅÔ∏è', 45: 'üå´Ô∏è', 61: 'üåßÔ∏è', 71: 'üå®Ô∏è', 95: '‚õàÔ∏è' };
            return icons[code] || 'üå§Ô∏è';
        }

        function findCurrentHourIndex(data) {
            const now = new Date().getHours();
            return data.hourly.time.findIndex(t => new Date(t).getHours() === now) || 0;
        }

        function selectModel(model) {
            appState.currentModel = model;
            document.querySelectorAll('.model-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.model === model);
            });
            renderUI();
        }

        function showLoading(show) {
            document.getElementById('loading').style.display = show ? 'block' : 'none';
        }

        function showAllSections() {
            document.getElementById('modelSelector').style.display = 'block';
            document.getElementById('tilesGrid').style.display = 'grid';
            document.getElementById('timelineSection').style.display = 'block';
            document.getElementById('profileSection').style.display = 'block';
            document.getElementById('comparisonSection').style.display = 'block';
        }

        function reloadData() {
            loadAllData();
        }

        function openLocationModal() {
            document.getElementById('locationModal').classList.add('active');
        }

        function closeLocationModal() {
            document.getElementById('locationModal').classList.remove('active');
        }

        function setPreset(lat, lon, name) {
            document.getElementById('inputLat').value = lat;
            document.getElementById('inputLon').value = lon;
            document.getElementById('inputName').value = name + ', –£–∫—Ä–∞—ó–Ω–∞';
        }

        function applyLocation() {
            appState.currentLocation = {
                lat: parseFloat(document.getElementById('inputLat').value),
                lon: parseFloat(document.getElementById('inputLon').value),
                name: document.getElementById('inputName').value
            };
            document.getElementById('locationName').textContent = appState.currentLocation.name;
            closeLocationModal();
            loadAllData();
        }
    </script>
</body>
</html>
