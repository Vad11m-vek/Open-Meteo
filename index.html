<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#2c5f2d">
    <title>UAV Forecast Pro</title>
    <link rel="manifest" href="manifest.json">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(180deg, #1a3a1c 0%, #2c5f2d 100%);
            color: #fff;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .header {
            background: rgba(0,0,0,0.3);
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .location {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 1.1rem;
            font-weight: 600;
        }

        .header-buttons {
            display: flex;
            gap: 10px;
        }

        .icon-btn {
            background: rgba(255,255,255,0.1);
            border: none;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.2rem;
            transition: all 0.2s;
        }

        .icon-btn:hover {
            background: rgba(255,255,255,0.2);
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 15px;
        }

        .model-selector {
            background: rgba(0,0,0,0.3);
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 15px;
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }

        .model-btn {
            flex: 1;
            min-width: 100px;
            padding: 10px 15px;
            background: rgba(255,255,255,0.1);
            border: 2px solid rgba(255,255,255,0.2);
            color: white;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.95rem;
            font-weight: 600;
            transition: all 0.2s;
        }

        .model-btn.active {
            background: rgba(76, 175, 80, 0.4);
            border-color: #4CAF50;
        }

        .compare-toggle {
            padding: 10px 20px;
            background: rgba(33, 150, 243, 0.3);
            border: 2px solid #2196F3;
            color: white;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.95rem;
            font-weight: 600;
        }

        .compare-toggle.active {
            background: rgba(33, 150, 243, 0.6);
        }

        .tiles-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 12px;
            margin-bottom: 20px;
        }

        .tile {
            background: rgba(0,0,0,0.3);
            border-radius: 12px;
            padding: 15px;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .tile-header {
            font-size: 0.85rem;
            opacity: 0.8;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .tile-value {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .tile-sub {
            font-size: 0.9rem;
            opacity: 0.7;
        }

        .timeline {
            background: rgba(0,0,0,0.3);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
            overflow-x: auto;
        }

        .timeline-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .timeline-controls {
            display: flex;
            gap: 8px;
        }

        .timeline-btn {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1.1rem;
        }

        .timeline-scroll {
            display: flex;
            gap: 8px;
            overflow-x: auto;
            padding: 10px 0;
        }

        .timeline-item {
            min-width: 70px;
            text-align: center;
            padding: 10px;
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            border: 2px solid transparent;
        }

        .timeline-item:hover {
            background: rgba(255,255,255,0.1);
        }

        .timeline-item.active {
            background: rgba(76, 175, 80, 0.3);
            border-color: #4CAF50;
        }

        .timeline-time {
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .timeline-wind {
            font-size: 0.85rem;
            opacity: 0.8;
        }

        .wind-profile {
            background: rgba(0,0,0,0.3);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .section-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .profile-table {
            width: 100%;
            border-collapse: collapse;
        }

        .profile-table th {
            background: rgba(255,255,255,0.1);
            padding: 10px 8px;
            text-align: left;
            font-size: 0.85rem;
            font-weight: 600;
            border-bottom: 2px solid rgba(255,255,255,0.2);
        }

        .profile-table td {
            padding: 10px 8px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            font-size: 0.9rem;
        }

        .profile-table tr:hover {
            background: rgba(255,255,255,0.05);
        }

        .comparison-table {
            width: 100%;
            border-collapse: collapse;
        }

        .comparison-table th {
            background: rgba(255,255,255,0.1);
            padding: 8px;
            text-align: center;
            font-size: 0.85rem;
            border-bottom: 2px solid rgba(255,255,255,0.2);
        }

        .comparison-table td {
            padding: 8px;
            text-align: center;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            font-size: 0.9rem;
        }

        .comparison-table tr:hover {
            background: rgba(255,255,255,0.05);
        }

        .model-tag {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .model-openmeteo { background: rgba(76, 175, 80, 0.3); }
        .model-windy { background: rgba(33, 150, 243, 0.3); }
        .model-weather { background: rgba(255, 152, 0, 0.3); }

        .loading {
            text-align: center;
            padding: 40px;
            font-size: 1.1rem;
        }

        .spinner {
            border: 3px solid rgba(255,255,255,0.1);
            border-top: 3px solid white;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .status {
            padding: 12px;
            border-radius: 8px;
            margin: 15px 0;
            font-size: 0.9rem;
        }

        .status.error {
            background: rgba(244, 67, 54, 0.2);
            border-left: 4px solid #f44336;
        }

        .status.success {
            background: rgba(76, 175, 80, 0.2);
            border-left: 4px solid #4CAF50;
        }

        .status.info {
            background: rgba(33, 150, 243, 0.2);
            border-left: 4px solid #2196F3;
        }

        @media (max-width: 600px) {
            .tiles-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .tile-value {
                font-size: 1.5rem;
            }

            .model-selector {
                flex-direction: column;
            }

            .model-btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="location">
            <span>üìç</span>
            <span id="location-name">–ö–∏—ó–≤, –£–∫—Ä–∞—ó–Ω–∞</span>
        </div>
        <div class="header-buttons">
            <button class="icon-btn" onclick="refreshData()" title="–û–Ω–æ–≤–∏—Ç–∏">üîÑ</button>
            <button class="icon-btn" onclick="showSettings()" title="–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è">‚öôÔ∏è</button>
        </div>
    </div>

    <div class="container">
        <!-- –í–∏–±—ñ—Ä –º–æ–¥–µ–ª—ñ -->
        <div class="model-selector">
            <button class="model-btn active" data-model="openmeteo" onclick="selectModel('openmeteo')">
                Open-Meteo
            </button>
            <button class="model-btn" data-model="windy" onclick="selectModel('windy')">
                Windy API
            </button>
            <button class="model-btn" data-model="weatherapi" onclick="selectModel('weatherapi')">
                WeatherAPI
            </button>
            <button class="compare-toggle" onclick="toggleCompare()">
                üî¨ –ü–æ—Ä—ñ–≤–Ω—è—Ç–∏
            </button>
        </div>

        <!-- –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è -->
        <div id="loading" class="loading" style="display: none;">
            <div class="spinner"></div>
            <p>–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö...</p>
        </div>

        <!-- –°—Ç–∞—Ç—É—Å -->
        <div id="status"></div>

        <!-- –û—Å–Ω–æ–≤–Ω—ñ –ø–ª–∏—Ç–∫–∏ -->
        <div class="tiles-grid" id="main-tiles">
            <!-- –ì–µ–Ω–µ—Ä—É—é—Ç—å—Å—è —á–µ—Ä–µ–∑ JS -->
        </div>

        <!-- Timeline -->
        <div class="timeline">
            <div class="timeline-header">
                <div class="section-title">‚è±Ô∏è –ü—Ä–æ–≥–Ω–æ–∑ –ø–æ –≥–æ–¥–∏–Ω–∞—Ö</div>
                <div class="timeline-controls">
                    <button class="timeline-btn" onclick="playTimeline()">‚ñ∂Ô∏è</button>
                    <button class="timeline-btn" onclick="stopTimeline()">‚è∏Ô∏è</button>
                </div>
            </div>
            <div class="timeline-scroll" id="timeline">
                <!-- –ì–µ–Ω–µ—Ä—É—î—Ç—å—Å—è —á–µ—Ä–µ–∑ JS -->
            </div>
        </div>

        <!-- –ü—Ä–æ—Ñ—ñ–ª—å –≤—ñ—Ç—Ä—É -->
        <div class="wind-profile" id="wind-profile-section">
            <div class="section-title">üå¨Ô∏è –ü—Ä–æ—Ñ—ñ–ª—å –≤—ñ—Ç—Ä—É –Ω–∞ –≤–∏—Å–æ—Ç–∞—Ö</div>
            <table class="profile-table" id="wind-profile-table">
                <thead>
                    <tr>
                        <th>–í–∏—Å–æ—Ç–∞</th>
                        <th>–®–≤–∏–¥–∫—ñ—Å—Ç—å –≤—ñ—Ç—Ä—É</th>
                        <th>–®–≤–∏–¥–∫—ñ—Å—Ç—å –ø–æ—Ä–∏–≤—ñ–≤</th>
                        <th>–ù–∞–ø—Ä—è–º–æ–∫</th>
                        <th>–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞</th>
                    </tr>
                </thead>
                <tbody id="profile-body">
                    <!-- –ì–µ–Ω–µ—Ä—É—î—Ç—å—Å—è —á–µ—Ä–µ–∑ JS -->
                </tbody>
            </table>
        </div>

        <!-- –ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –º–æ–¥–µ–ª–µ–π -->
        <div class="wind-profile" id="comparison-section" style="display: none;">
            <div class="section-title">üî¨ –ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –º–æ–¥–µ–ª–µ–π</div>
            <table class="comparison-table" id="comparison-table">
                <!-- –ì–µ–Ω–µ—Ä—É—î—Ç—å—Å—è —á–µ—Ä–µ–∑ JS -->
            </table>
        </div>
    </div>

    <script>
        // –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è
        const CONFIG = {
            openmeteo: {
                name: 'Open-Meteo',
                url: 'https://api.open-meteo.com/v1/forecast',
                color: '#4CAF50'
            },
            windy: {
                name: 'Windy',
                url: 'https://api.windy.com/api/point-forecast/v2',
                key: '8LSlMIu1xWAVn4ePmrgxIMyzvg9VBC6G',
                color: '#2196F3'
            },
            weatherapi: {
                name: 'WeatherAPI',
                url: 'https://api.weatherapi.com/v1/forecast.json',
                key: 'YOUR_KEY', // –ü–æ—Ç—Ä—ñ–±–µ–Ω –∫–ª—é—á
                color: '#FF9800'
            }
        };

        // –°—Ç–∞–Ω –¥–æ–¥–∞—Ç–∫—É
        let currentModel = 'openmeteo';
        let compareMode = false;
        let location = { lat: 50.45, lon: 30.52, name: '–ö–∏—ó–≤, –£–∫—Ä–∞—ó–Ω–∞' };
        let weatherData = {};
        let timelineInterval = null;
        let currentTimeIndex = 0;

        // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è
        document.addEventListener('DOMContentLoaded', () => {
            loadData();
        });

        // –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö
        async function loadData() {
            showLoading(true);
            showStatus('–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö...', 'info');

            try {
                // –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ –∑ —É—Å—ñ—Ö –¥–∂–µ—Ä–µ–ª –ø–∞—Ä–∞–ª–µ–ª—å–Ω–æ
                const results = await Promise.allSettled([
                    fetchOpenMeteoData(),
                    fetchWindyData(),
                    // fetchWeatherAPIData() // –ó–∞–∫–æ–º–µ–Ω—Ç–æ–≤–∞–Ω–æ, –ø–æ–∫–∏ –Ω–µ–º–∞—î –∫–ª—é—á–∞
                ]);

                weatherData = {};
                
                if (results[0].status === 'fulfilled') {
                    weatherData.openmeteo = results[0].value;
                }
                
                if (results[1].status === 'fulfilled') {
                    weatherData.windy = results[1].value;
                }

                console.log('–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω—ñ –¥–∞–Ω—ñ:', weatherData);

                if (Object.keys(weatherData).length === 0) {
                    throw new Error('–ù–µ –≤–¥–∞–ª–æ—Å—è –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –¥–∞–Ω—ñ –∑ –∂–æ–¥–Ω–æ–≥–æ –¥–∂–µ—Ä–µ–ª–∞');
                }

                renderUI();
                showStatus(`‚úÖ –î–∞–Ω—ñ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ —É—Å–ø—ñ—à–Ω–æ`, 'success');
            } catch (error) {
                console.error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è:', error);
                showStatus(`‚ùå –ü–æ–º–∏–ª–∫–∞: ${error.message}`, 'error');
            } finally {
                showLoading(false);
            }
        }

        // Open-Meteo API
        async function fetchOpenMeteoData() {
            const url = `${CONFIG.openmeteo.url}?` +
                `latitude=${location.lat}&longitude=${location.lon}` +
                `&hourly=windspeed_10m,windspeed_80m,windspeed_120m,windspeed_180m` +
                `,winddirection_10m,winddirection_80m,winddirection_120m,winddirection_180m` +
                `,windgusts_10m` +
                `,temperature_2m,temperature_80m,temperature_120m,temperature_180m` +
                `,relativehumidity_2m,dewpoint_2m` +
                `,cloudcover,cloudcover_low,cloudcover_mid,cloudcover_high` +
                `,visibility,precipitation` +
                `&timezone=auto&forecast_days=3`;

            const response = await fetch(url);
            if (!response.ok) throw new Error('Open-Meteo API error');
            return await response.json();
        }

        // Windy API
        async function fetchWindyData() {
            const url = CONFIG.windy.url;
            const body = {
                lat: location.lat,
                lon: location.lon,
                model: "gfs",
                parameters: ["wind", "temp", "dewpoint", "rh", "pressure"],
                levels: ["surface", "950h", "900h", "850h", "800h", "700h", "600h", "500h"],
                key: CONFIG.windy.key
            };

            const response = await fetch(url, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(body)
            });

            if (!response.ok) throw new Error('Windy API error');
            return await response.json();
        }

        // –í–∏–±—ñ—Ä –º–æ–¥–µ–ª—ñ
        function selectModel(model) {
            currentModel = model;
            document.querySelectorAll('.model-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.model === model);
            });
            renderUI();
        }

        // –ü–µ—Ä–µ–º–∏–∫–∞–Ω–Ω—è —Ä–µ–∂–∏–º—É –ø–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è
        function toggleCompare() {
            compareMode = !compareMode;
            document.querySelector('.compare-toggle').classList.toggle('active', compareMode);
            renderUI();
        }

        // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ UI
        function renderUI() {
            if (!weatherData[currentModel] && !compareMode) {
                showStatus('‚ö†Ô∏è –î–∞–Ω—ñ –¥–ª—è –æ–±—Ä–∞–Ω–æ—ó –º–æ–¥–µ–ª—ñ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ñ', 'error');
                return;
            }

            if (compareMode) {
                renderComparison();
            } else {
                renderSingleModel();
            }
        }

        // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –æ–¥–Ω–æ—ó –º–æ–¥–µ–ª—ñ
        function renderSingleModel() {
            const data = weatherData[currentModel];
            if (!data) return;

            // –•–æ–≤–∞—î–º–æ –ø–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è, –ø–æ–∫–∞–∑—É—î–º–æ –ø—Ä–æ—Ñ—ñ–ª—å
            document.getElementById('comparison-section').style.display = 'none';
            document.getElementById('wind-profile-section').style.display = 'block';

            if (currentModel === 'openmeteo') {
                renderOpenMeteoUI(data);
            } else if (currentModel === 'windy') {
                renderWindyUI(data);
            }
        }

        // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ Open-Meteo
        function renderOpenMeteoUI(data) {
            const now = new Date();
            const currentHourIndex = new Date(data.hourly.time[0]).getHours();
            const nowIndex = now.getHours() - currentHourIndex;

            // –ü–ª–∏—Ç–∫–∏
            const tiles = [
                {
                    icon: 'üí®',
                    label: '–í—ñ—Ç–µ—Ä (10–º)',
                    value: `${Math.round(data.hourly.windspeed_10m[nowIndex])} –∫–º/–≥–æ–¥`,
                    sub: getDirectionName(data.hourly.winddirection_10m[nowIndex])
                },
                {
                    icon: 'üå™Ô∏è',
                    label: '–ü–æ—Ä–∏–≤–∏',
                    value: `${Math.round(data.hourly.windgusts_10m[nowIndex])} –∫–º/–≥–æ–¥`,
                    sub: '–º–∞–∫—Å–∏–º–∞–ª—å–Ω—ñ'
                },
                {
                    icon: 'üå°Ô∏è',
                    label: '–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞',
                    value: `${Math.round(data.hourly.temperature_2m[nowIndex])}¬∞C`,
                    sub: `–í–æ–ª–æ–≥—ñ—Å—Ç—å: ${data.hourly.relativehumidity_2m[nowIndex]}%`
                },
                {
                    icon: '‚òÅÔ∏è',
                    label: '–•–º–∞—Ä–Ω—ñ—Å—Ç—å',
                    value: `${data.hourly.cloudcover[nowIndex]}%`,
                    sub: `–ë–∞–∑–∞: ${data.hourly.cloudcover_low[nowIndex]}%`
                },
                {
                    icon: 'üëÅÔ∏è',
                    label: '–í–∏–¥–∏–º—ñ—Å—Ç—å',
                    value: `${Math.round(data.hourly.visibility[nowIndex] / 1000)} –∫–º`,
                    sub: ''
                },
                {
                    icon: 'üíß',
                    label: '–û–ø–∞–¥–∏',
                    value: `${data.hourly.precipitation[nowIndex]} –º–º`,
                    sub: ''
                }
            ];

            renderTiles(tiles);
            renderTimeline(data);
            renderWindProfile(data);
        }

        // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ Windy
        function renderWindyUI(data) {
            // Windy –ø–æ–≤–µ—Ä—Ç–∞—î –¥–∞–Ω—ñ –∫–æ–∂–Ω—ñ 3 –≥–æ–¥–∏–Ω–∏
            const now = Date.now();
            const currentIndex = data.ts.findIndex(ts => ts >= now);

            // –ö–æ–Ω–≤–µ—Ä—Ç—É—î–º–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏ U/V —É —à–≤–∏–¥–∫—ñ—Å—Ç—å —Ç–∞ –Ω–∞–ø—Ä—è–º–æ–∫
            const windSurface = calculateWind(
                data['wind_u-surface'][currentIndex],
                data['wind_v-surface'][currentIndex]
            );

            const tiles = [
                {
                    icon: 'üí®',
                    label: '–í—ñ—Ç–µ—Ä (–ø–æ–≤–µ—Ä—Ö–Ω—è)',
                    value: `${Math.round(windSurface.speed)} –∫–º/–≥–æ–¥`,
                    sub: getDirectionName(windSurface.direction)
                },
                {
                    icon: 'üå°Ô∏è',
                    label: '–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞',
                    value: `${Math.round(data['temp-surface'][currentIndex])}¬∞C`,
                    sub: `–¢–æ—á–∫–∞ —Ä–æ—Å–∏: ${Math.round(data['dewpoint-surface'][currentIndex])}¬∞C`
                },
                {
                    icon: 'üíß',
                    label: '–í–æ–ª–æ–≥—ñ—Å—Ç—å',
                    value: `${Math.round(data['rh-surface'][currentIndex])}%`,
                    sub: ''
                },
                {
                    icon: 'üéöÔ∏è',
                    label: '–¢–∏—Å–∫',
                    value: `${Math.round(data['pressure-surface'][currentIndex])} hPa`,
                    sub: ''
                }
            ];

            renderTiles(tiles);
            renderWindyTimeline(data);
            renderWindyProfile(data);
        }

        // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –ø–ª–∏—Ç–æ–∫
        function renderTiles(tiles) {
            const html = tiles.map(tile => `
                <div class="tile">
                    <div class="tile-header">${tile.icon} ${tile.label}</div>
                    <div class="tile-value">${tile.value}</div>
                    ${tile.sub ? `<div class="tile-sub">${tile.sub}</div>` : ''}
                </div>
            `).join('');
            document.getElementById('main-tiles').innerHTML = html;
        }

        // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ timeline (Open-Meteo)
        function renderTimeline(data) {
            const hours = data.hourly.time.slice(0, 24); // –ü–µ—Ä—à—ñ 24 –≥–æ–¥–∏–Ω–∏
            const html = hours.map((time, index) => {
                const hour = new Date(time).getHours();
                const wind = Math.round(data.hourly.windspeed_10m[index]);
                return `
                    <div class="timeline-item ${index === 0 ? 'active' : ''}" onclick="selectTimelineItem(${index})">
                        <div class="timeline-time">${hour.toString().padStart(2, '0')}:00</div>
                        <div class="timeline-wind">${wind} –∫–º/–≥–æ–¥</div>
                    </div>
                `;
            }).join('');
            document.getElementById('timeline').innerHTML = html;
        }

        // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ timeline (Windy)
        function renderWindyTimeline(data) {
            const times = data.ts.slice(0, 16); // –ü–µ—Ä—à—ñ 16 —Ç–æ—á–æ–∫ (48 –≥–æ–¥–∏–Ω / 3)
            const html = times.map((ts, index) => {
                const date = new Date(ts);
                const hour = date.getHours();
                const wind = calculateWind(
                    data['wind_u-surface'][index],
                    data['wind_v-surface'][index]
                );
                return `
                    <div class="timeline-item ${index === 0 ? 'active' : ''}" onclick="selectTimelineItem(${index})">
                        <div class="timeline-time">${hour.toString().padStart(2, '0')}:00</div>
                        <div class="timeline-wind">${Math.round(wind.speed)} –∫–º/–≥–æ–¥</div>
                    </div>
                `;
            }).join('');
            document.getElementById('timeline').innerHTML = html;
        }

        // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –ø—Ä–æ—Ñ—ñ–ª—é –≤—ñ—Ç—Ä—É (Open-Meteo)
        function renderWindProfile(data) {
            const nowIndex = 0; // –ü–æ—Ç–æ—á–Ω–∞ –≥–æ–¥–∏–Ω–∞
            
            const levels = [
                { height: '10–º', 
                  speed: data.hourly.windspeed_10m[nowIndex], 
                  gusts: data.hourly.windgusts_10m[nowIndex],
                  dir: data.hourly.winddirection_10m[nowIndex],
                  temp: data.hourly.temperature_2m[nowIndex]
                },
                { height: '80–º', 
                  speed: data.hourly.windspeed_80m[nowIndex], 
                  gusts: '-',
                  dir: data.hourly.winddirection_80m[nowIndex],
                  temp: data.hourly.temperature_80m[nowIndex]
                },
                { height: '120–º', 
                  speed: data.hourly.windspeed_120m[nowIndex], 
                  gusts: '-',
                  dir: data.hourly.winddirection_120m[nowIndex],
                  temp: data.hourly.temperature_120m[nowIndex]
                },
                { height: '180–º', 
                  speed: data.hourly.windspeed_180m[nowIndex], 
                  gusts: '-',
                  dir: data.hourly.winddirection_180m[nowIndex],
                  temp: data.hourly.temperature_180m[nowIndex]
                }
            ];

            const html = levels.map(level => `
                <tr>
                    <td><strong>${level.height}</strong></td>
                    <td>${Math.round(level.speed)} –∫–º/–≥–æ–¥</td>
                    <td>${typeof level.gusts === 'number' ? Math.round(level.gusts) + ' –∫–º/–≥–æ–¥' : level.gusts}</td>
                    <td>${Math.round(level.dir)}¬∞ (${getDirectionName(level.dir)})</td>
                    <td>${Math.round(level.temp)}¬∞C</td>
                </tr>
            `).join('');

            document.getElementById('profile-body').innerHTML = html;
        }

        // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –ø—Ä–æ—Ñ—ñ–ª—é –≤—ñ—Ç—Ä—É (Windy)
        function renderWindyProfile(data) {
            const nowIndex = 0;
            
            // Windy –¥–∞—î –¥–∞–Ω—ñ –Ω–∞ —Ä—ñ–∑–Ω–∏—Ö —Ä—ñ–≤–Ω—è—Ö —Ç–∏—Å–∫—É
            // –ö–æ–Ω–≤–µ—Ä—Ç—É—î–º–æ –≥–ü–∞ ‚Üí –ø—Ä–∏–±–ª–∏–∑–Ω–∞ –≤–∏—Å–æ—Ç–∞
            const pressureLevels = {
                'surface': { height: '10–º' },
                '950h': { height: '500–º' },
                '900h': { height: '1000–º' },
                '850h': { height: '1500–º' },
                '800h': { height: '2000–º' },
                '700h': { height: '3000–º' },
                '600h': { height: '4200–º' },
                '500h': { height: '5500–º' }
            };

            const html = Object.entries(pressureLevels).map(([level, info]) => {
                const windKey = `wind_u-${level}`;
                if (!data[windKey]) return '';

                const wind = calculateWind(data[windKey][nowIndex], data[`wind_v-${level}`][nowIndex]);
                const temp = data[`temp-${level}`] ? data[`temp-${level}`][nowIndex] : '-';

                return `
                    <tr>
                        <td><strong>${info.height}</strong></td>
                        <td>${Math.round(wind.speed)} –∫–º/–≥–æ–¥</td>
                        <td>-</td>
                        <td>${Math.round(wind.direction)}¬∞ (${getDirectionName(wind.direction)})</td>
                        <td>${typeof temp === 'number' ? Math.round(temp) + '¬∞C' : temp}</td>
                    </tr>
                `;
            }).filter(row => row).join('');

            document.getElementById('profile-body').innerHTML = html;
        }

        // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –ø–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è
        function renderComparison() {
            document.getElementById('wind-profile-section').style.display = 'none';
            document.getElementById('comparison-section').style.display = 'block';

            const comparison = {
                '–í—ñ—Ç–µ—Ä 10–º': {},
                '–ü–æ—Ä–∏–≤–∏ 10–º': {},
                '–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞': {},
                '–í–æ–ª–æ–≥—ñ—Å—Ç—å': {},
                '–í—ñ—Ç–µ—Ä 1000–º': {}
            };

            // Open-Meteo
            if (weatherData.openmeteo) {
                const data = weatherData.openmeteo;
                comparison['–í—ñ—Ç–µ—Ä 10–º']['Open-Meteo'] = `${Math.round(data.hourly.windspeed_10m[0])} –∫–º/–≥–æ–¥`;
                comparison['–ü–æ—Ä–∏–≤–∏ 10–º']['Open-Meteo'] = `${Math.round(data.hourly.windgusts_10m[0])} –∫–º/–≥–æ–¥`;
                comparison['–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞']['Open-Meteo'] = `${Math.round(data.hourly.temperature_2m[0])}¬∞C`;
                comparison['–í–æ–ª–æ–≥—ñ—Å—Ç—å']['Open-Meteo'] = `${data.hourly.relativehumidity_2m[0]}%`;
                comparison['–í—ñ—Ç–µ—Ä 1000–º']['Open-Meteo'] = '-';
            }

            // Windy
            if (weatherData.windy) {
                const data = weatherData.windy;
                const wind = calculateWind(data['wind_u-surface'][0], data['wind_v-surface'][0]);
                const wind900 = calculateWind(data['wind_u-900h'][0], data['wind_v-900h'][0]);
                
                comparison['–í—ñ—Ç–µ—Ä 10–º']['Windy'] = `${Math.round(wind.speed)} –∫–º/–≥–æ–¥`;
                comparison['–ü–æ—Ä–∏–≤–∏ 10–º']['Windy'] = '-';
                comparison['–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞']['Windy'] = `${Math.round(data['temp-surface'][0])}¬∞C`;
                comparison['–í–æ–ª–æ–≥—ñ—Å—Ç—å']['Windy'] = `${Math.round(data['rh-surface'][0])}%`;
                comparison['–í—ñ—Ç–µ—Ä 1000–º']['Windy'] = `${Math.round(wind900.speed)} –∫–º/–≥–æ–¥`;
            }

            const sources = ['Open-Meteo', 'Windy'];
            
            let html = '<thead><tr><th>–ü–∞—Ä–∞–º–µ—Ç—Ä</th>';
            sources.forEach(source => {
                if (weatherData[source.toLowerCase().replace('-', '')]) {
                    html += `<th>${source}</th>`;
                }
            });
            html += '</tr></thead><tbody>';

            Object.entries(comparison).forEach(([param, values]) => {
                html += `<tr><td><strong>${param}</strong></td>`;
                sources.forEach(source => {
                    if (weatherData[source.toLowerCase().replace('-', '')]) {
                        html += `<td>${values[source] || '-'}</td>`;
                    }
                });
                html += '</tr>';
            });

            html += '</tbody>';
            document.getElementById('comparison-table').innerHTML = html;
        }

        // –î–æ–ø–æ–º—ñ–∂–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó
        function calculateWind(u, v) {
            const speed = Math.sqrt(u * u + v * v) * 3.6; // –º/—Å ‚Üí –∫–º/–≥–æ–¥
            const direction = (Math.atan2(-u, -v) * 180 / Math.PI + 360) % 360;
            return { speed, direction };
        }

        function getDirectionName(deg) {
            const directions = ['–ü–Ω', '–ü–Ω–°—Ö', '–°—Ö', '–ü–¥–°—Ö', '–ü–¥', '–ü–¥–ó—Ö', '–ó—Ö', '–ü–Ω–ó—Ö'];
            return directions[Math.round(deg / 45) % 8];
        }

        function showLoading(show) {
            document.getElementById('loading').style.display = show ? 'block' : 'none';
        }

        function showStatus(message, type) {
            const statusDiv = document.getElementById('status');
            statusDiv.innerHTML = `<div class="status ${type}">${message}</div>`;
            setTimeout(() => statusDiv.innerHTML = '', 5000);
        }

        function refreshData() {
            loadData();
        }

        function showSettings() {
            alert('–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –≤ —Ä–æ–∑—Ä–æ–±—Ü—ñ');
        }

        function selectTimelineItem(index) {
            currentTimeIndex = index;
            document.querySelectorAll('.timeline-item').forEach((item, i) => {
                item.classList.toggle('active', i === index);
            });
            // –¢—É—Ç –º–æ–∂–Ω–∞ –æ–Ω–æ–≤–∏—Ç–∏ –¥–∞–Ω—ñ –Ω–∞ –æ—Å–Ω–æ–≤—ñ –æ–±—Ä–∞–Ω–æ–≥–æ —á–∞—Å—É
        }

        function playTimeline() {
            stopTimeline();
            timelineInterval = setInterval(() => {
                const items = document.querySelectorAll('.timeline-item');
                currentTimeIndex = (currentTimeIndex + 1) % items.length;
                selectTimelineItem(currentTimeIndex);
            }, 2000);
        }

        function stopTimeline() {
            if (timelineInterval) {
                clearInterval(timelineInterval);
                timelineInterval = null;
            }
        }
    </script>
</body>
</html>
